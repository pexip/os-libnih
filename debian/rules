#!/usr/bin/make -f
%:
	dh $@


CFLAGS := -Wall -fstack-protector -fPIE $(shell dpkg-buildflags --get CFLAGS)
LDFLAGS := -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -pie $(shell dpkg-buildflags --get LDFLAGS)

DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

override_dh_auto_configure:
	dh_auto_configure -- CFLAGS="$(CFLAGS)" LDFLAGS="$(LDFLAGS)" \
		--libdir=/lib/$(DEB_HOST_MULTIARCH)

override_dh_auto_install:
	dh_auto_install -- pkgconfigdir=\$${prefix}/lib/$(DEB_HOST_MULTIARCH)/pkgconfig

override_dh_makeshlibs:
	dh_makeshlibs -plibnih1 -V 'libnih1 (>= 1.0.0)'
	dh_makeshlibs -plibnih-dbus1 -V 'libnih-dbus1 (>= 1.0.0)'
	dh_makeshlibs -Nlibnih1 -Nlibnih-dbus1

override_dh_shlibdeps:
	dh_shlibdeps
	sed -i 's/2\.14/2.15/' debian/*.substvars
	sed -i 's/>= 2.15)/>= 2.15~)/g' debian/*.substvars


# Symlink /usr/share/doc directories together
override_dh_installdocs:
	dh_installdocs -Nlibnih-dev -Nlibnih-dbus1 -Nlibnih-dbus-dev \
		-Nnih-dbus-tool

override_dh_installchangelogs:
	dh_installchangelogs -Nlibnih-dev -Nlibnih-dbus1 -Nlibnih-dbus-dev \
		-Nnih-dbus-tool
